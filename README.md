# OptiCIF

OptiCIF is a Python package for performing global optimization on [CIF](https://eclipse.dev/escet/cif/) specifications by reordering plant instantiations or explicit plant automaton declarations according to a provided input sequence. Global optimization is formally defined in Reijnen ([2020](https://www.persistent-identifier.nl/urn:nbn:nl:ui:25-115168de-878f-4f5f-9c55-126f20f845fe)). It integrates in the [synthesis-based engineering](https://www.eclipse.org/escet/cif/synthesis-based-engineering/approaches/synthesis-based-engineering.html) development process. This package was developed as part of a bachelor thesis at the Eindhoven University of Technology.

Modules:
- `csv_utils`: Utility functions for working with CSV files, including:
  - converting a list of sequenced RaGraph node objects to a CSV file; 
  - converting a binary DSM matrix in .mat to an edge list in CSV format, using node names from a separate CSV file; 
  - generating a CSV file with ordered node names based on plant group information from a product system map and a group 
    sequence .mat file.
- `validators`: Functions for validating the structure of CSV files containing node sequences and binary DSM matrices.
- `cif_transformer`: Function for performing global optimization by reordering plant instantiations or explicit plant automaton declarations.

## Installation

To use OptiCIF, clone the repository:

```bash
git clone https://github.com/jdelagedavies/opticif.git
```

The project is managed using Poetry. Ensure that you have [Poetry installed](https://python-poetry.org/docs/#installation) and then install the dependencies:

```bash
cd opticif
poetry install
```

Alternatively, install the dependencies manually. You can find the list of dependencies in the `pyproject.toml file`, under the `[tool.poetry.dependencies]` section.

## Usage

OptiCIF can be used as a standalone tool for global optimization on CIF specifications. It also offers seamless integration with input sequences generated by the [RaGraph package](https://ragraph.ratio-case.nl/) and the MATLAB sequencing script developed by de Jong ([2019](https://research.tue.nl/en/studentTheses/9bcf3b6d-18e5-4c3e-8c89-2e9ebe64dec0)).

Here's a basic example of using OptiCIF to perform global optimization on a CIF specification with the "instantiation" mode:

```python
from opticif import do_global_optimization

# Define input files
cif_path = "path/to/your/cif/specification.cif"
csv_path = "path/to/your/sequence.csv"  # CSV file containing the node sequence

# Perform global optimization with the "automaton" mode
do_global_optimization(csv_path, cif_path, mode="automaton")
```

The input CSV file containing the node sequence should have a header with a "name" column, listing the nodes to be reordered. Ensure that the node names in the CSV file match the node names in your CIF specification. Example input CSV format:

```csv
name
a
b
c
d
e
f
```
The `mode` parameter can be set to either "automaton" or "instantiation":

- "automaton": Reorder explicit plant automaton declarations (e.g., "plant automaton Node1: ... end")
- "instantiation": Reorder plant instantiations (e.g., "Node1: Plant;")

Note that plant elements must either be fully declared explicitely, or fully instantiated. This tool does not support groups, see [CIF to CIF transformer](https://www.eclipse.org/escet/cif/tools/cif2cif/) for information on how to remove groups as a preprocessing step.

Example CIF models and corresponding input files can be found in the tests/models directory of the repository. For more advanced usage, see the test scripts provided in the repository.

For detailed information on the functions and their parameters, refer to the function documentation (docstrings) in the source code.

## License

[MIT](LICENSE)
